<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instant Loop Carousel</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: #111;
      }

      .slider-container {
        width: 100vw;
        height: 300px;
        overflow: hidden;
        position: relative;
        cursor: grab;
      }

      .slider-track {
        display: flex;
        transition: transform 0.3s ease;
      }

      .slide {
        flex: 0 0 100vw;
        height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: white;
        user-select: none;
      }

      .slide:nth-child(1) {
        background-color: #2ed573;
      } /* clone of last */
      .slide:nth-child(2) {
        background-color: #ff4757;
      }
      .slide:nth-child(3) {
        background-color: #1e90ff;
      }
      .slide:nth-child(4) {
        background-color: #2ed573;
      }
      .slide:nth-child(5) {
        background-color: #ff4757;
      } /* clone of first */

      .grabbing {
        cursor: grabbing;
      }
    </style>
  </head>
  <body>
    <div class="slider-container" id="sliderContainer">
      <div class="slider-track" id="sliderTrack">
        <!-- Clone last -->
        <div class="slide">Slide 3</div>
        <!-- Real slides -->
        <div class="slide">Slide 1</div>
        <div class="slide">Slide 2</div>
        <div class="slide">Slide 3</div>
        <!-- Clone first -->
        <div class="slide">Slide 1</div>
      </div>
    </div>

    <script>
      const container = document.getElementById("sliderContainer");
      const track = document.getElementById("sliderTrack");
      const slides = document.querySelectorAll(".slide");
      const slideCount = 3;
      const slideWidth = window.innerWidth;

      let index = 1; // Start at real Slide 1 (second child)
      let isDragging = false;
      let startX = 0;
      let currentTranslate = -slideWidth;
      let prevTranslate = -slideWidth;
      let animationID;

      track.style.transform = `translateX(${currentTranslate}px)`;

      function setSliderPosition() {
        track.style.transform = `translateX(${currentTranslate}px)`;
      }

      function animation() {
        setSliderPosition();
        if (isDragging) requestAnimationFrame(animation);
      }

      function startDrag(e) {
        isDragging = true;
        startX = getPositionX(e);
        container.classList.add("grabbing");
        cancelAnimationFrame(animationID);
        animationID = requestAnimationFrame(animation);
      }

      function drag(e) {
        if (!isDragging) return;
        const currentX = getPositionX(e);
        const diff = currentX - startX;
        currentTranslate = prevTranslate + diff;
      }

      function endDrag() {
        isDragging = false;
        container.classList.remove("grabbing");
        const movedBy = currentTranslate - prevTranslate;

        if (movedBy < -100) index++;
        else if (movedBy > 100) index--;

        moveToIndex();
      }

      function moveToIndex() {
        track.style.transition = "transform 0.3s ease";
        currentTranslate = -index * slideWidth;
        prevTranslate = currentTranslate;
        setSliderPosition();
      }

      function getPositionX(e) {
        return e.type.includes("mouse") ? e.pageX : e.touches[0].clientX;
      }

      function checkLoop() {
        track.style.transition = "none";
        if (index === 0) {
          index = slideCount;
          currentTranslate = -index * slideWidth;
          prevTranslate = currentTranslate;
          setSliderPosition();
        }
        if (index === slideCount + 1) {
          index = 1;
          currentTranslate = -index * slideWidth;
          prevTranslate = currentTranslate;
          setSliderPosition();
        }
      }

      // Auto Slide
      let auto = setInterval(() => {
        index++;
        moveToIndex();
      }, 3000);

      // Reset auto when dragging
      function resetAuto() {
        clearInterval(auto);
        auto = setInterval(() => {
          index++;
          moveToIndex();
        }, 3000);
      }

      // Transition End Listener for Loop
      track.addEventListener("transitionend", checkLoop);

      // Events
      container.addEventListener("mousedown", (e) => {
        startDrag(e);
        resetAuto();
      });
      container.addEventListener("mousemove", drag);
      container.addEventListener("mouseup", endDrag);
      container.addEventListener("mouseleave", () => isDragging && endDrag());

      container.addEventListener("touchstart", (e) => {
        startDrag(e);
        resetAuto();
      });
      container.addEventListener("touchmove", drag);
      container.addEventListener("touchend", endDrag);
    </script>
  </body>
</html>
